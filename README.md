# Sol - AI-Powered Discord Bot

Sol is an advanced Discord bot powered by Google's Gemini 2.5 Flash that provides natural conversational interactions. It makes independent decisions about when to join discussions, responds with concise messages, and understands complex social context.

## Important Legal Disclaimers

### AI Disclosure
- Sol is an AI assistant and should be clearly identified as such to all users
- The bot's system prompt and configuration should be set to acknowledge its AI nature
- Misrepresenting Sol as a human may violate platform terms of service and regulations in some jurisdictions

### Data Privacy
- This bot processes and stores conversation data temporarily for context
- No personal data should be collected beyond what's necessary for functionality
- Consider implementing data retention policies that automatically delete old conversations
- Ensure compliance with relevant data protection laws (GDPR, CCPA, etc.) in your region

### Terms of Service Compliance
- Usage of this bot must comply with Discord's Terms of Service and Developer Policies
- The bot must not be used to circumvent platform limitations or violate community guidelines
- Ensure all interactions follow Discord's rules regarding bots and automated systems

### API Usage
- This bot uses third-party APIs (OpenRouter/Gemini) that have their own terms of service
- Ensure your usage complies with the API provider's policies and rate limits
- You are responsible for any costs associated with API usage
- API keys should be kept secure and never shared publicly

### Content Moderation
- You are responsible for moderating content generated by the bot
- Configure moderation settings appropriately for your community
- The AI moderation system is not perfect and requires human oversight
- You may be liable for harmful content generated by the bot if insufficient safeguards are in place

### Intellectual Property
- Content generated by AI may have complex copyright implications
- Consider implementing appropriate attribution for AI-generated content
- Respect intellectual property rights in your bot's responses and functionality

### License
This project is provided under the MIT License, making it fully open source. You are free to use, modify, distribute, and even use it.

## What Sol Does

- **Natural Conversational AI** - Uses casual language, concise messages, and natural conversation style
- **AI-Only Decision Making** - Every response decision is AI-driven with no keyword triggers
- **Deep Conversation Awareness** - Understands who's talking to whom and avoids interrupting
- **Complementary Responses** - Never repeats information others have already provided
- **Selective Engagement** - Only responds when it can add genuine value to conversations
- **Smart Message Analysis** - Analyzes up to 100 messages of context when needed
- **Customizable Personality** - Adjust chattiness, patience, and formality via simple commands
- **Channel-Specific Activation** - Control which channels Sol participates in
- **AI-Powered Moderation** - Intelligently enforces community rules with configurable warnings and timeouts

## Key Features

### Personality System
Use `/personality` to control Sol's behavior with three simple sliders:
- **Chatty (1-10)** - How often Sol jumps into conversations
- **Patience (1-10)** - How long Sol waits for complete thoughts
- **Formality (1-10)** - How formal/detailed Sol's responses are

### Moderation System
Sol includes a sophisticated AI-powered moderation system that:

1. **Detects rule violations** using Gemini 2.5's contextual understanding  
2. **Issues graduated warnings** that increase in severity with repeat violations
3. **Tracks user violations** for 24-hour periods to identify problem behavior
4. **Applies timeouts** to users who exceed the warning threshold
5. **Deletes rule-violating messages** to keep the chat clean
6. **Logs all moderation actions** to a designated channel
7. **Auto-deletes warning messages** after a configurable time period

### Conversation Intelligence
- Uses AI for ALL response decisions - no automated triggering
- Identifies when other users have already answered questions
- Recognizes who messages are addressed to, even without @ mentions
- Analyzes conversation threads to avoid interrupting discussions
- Stays silent when it has nothing valuable to add
- Can analyze up to 100 messages of context for complex topics

## Setup Guide (Ubuntu VPS)

### Prerequisites

- Ubuntu server
- Python 3.8+ 
- Discord account
- OpenRouter account with API key

### Step 1: Install Basic Requirements

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install required packages
sudo apt install python3 python3-pip python3-venv git screen -y
```

### Step 2: Create Virtual Environment (IMPORTANT)

```bash
# Create project directory
mkdir -p ~/sol
cd ~/sol

# Create and activate virtual environment
python3 -m venv venv
source venv/bin/activate

# You should now see (venv) at the start of your prompt
```

### Step 3: Clone or Upload Files

Either clone from git or upload your local files to the server.

```bash
# Option 1: Clone from git
git clone https://github.com/yourusername/sol-discord-bot.git .

# Option 2: Upload local files via SFTP
# Use FileZilla or similar to upload files to ~/sol
```

### Step 4: Install Dependencies

```bash
# Make sure you're in the project dir with venv activated
cd ~/sol
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

### Step 5: Setup Discord Bot

1. Go to [Discord Developer Portal](https://discord.com/developers/applications)
2. Click "New Application" and name it
3. Go to the "Bot" tab and click "Add Bot"
4. Under "Privileged Gateway Intents" enable ALL intents:
   - Message Content Intent
   - Server Members Intent
   - Presence Intent
5. Save changes and copy your bot token

### Step 6: Create .env File

```bash
# Create env file
nano ~/sol/.env
```

Add these lines:
```
DISCORD_TOKEN=your_discord_bot_token_here
OPENROUTER_API_KEY=your_openrouter_api_key_here
```

Save with Ctrl+O, exit with Ctrl+X

### Environment Variables

The following environment variables are used by Sol:

* `DISCORD_TOKEN`: Your Discord bot token
* `OPENROUTER_API_KEY`: Your OpenRouter API key
* `GITHUB_TOKEN`: Your GitHub personal access token (required for GitHub issue creation)
* `GITHUB_REPO`: Default GitHub repository in format "username/repo" (optional)

Make sure to replace `your_discord_bot_token_here` and `your_openrouter_api_key_here` with your actual token and API key.

### Admin Commands

The following admin commands are available:

#### Channel Controls
* `/activate [channel]`: Turn Sol on in a specific channel
* `/deactivate [channel]`: Turn Sol off in a specific channel
* `/activateall`: Turn Sol on in all channels
* `/deactivateall`: Turn Sol off everywhere
* `/channels`: List channels where Sol is active

#### Personality Settings
* `/personality`: Configure Sol's behavior:
  * `chatty (1-10)`: How often Sol joins conversations
  * `patience (1-10)`: How long Sol waits for complete thoughts
  * `formality (1-10)`: How formal Sol's responses are
* `/setwindow [size]`: Set how many messages Sol remembers (5-50)
* `/setcasual [level]`: Set how casual Sol's replies are (1-10)
* `/timing [min] [max]`: Set typing delay in seconds

#### Moderation Commands
* `/modconfig`: Configure core moderation settings (enable/disable, timeouts, thresholds)
* `/setlogchannel`: Set up a logging channel and configure message deletion settings
* `/exemptrolefrommod`: Add or remove roles that are exempt from moderation (e.g., admin roles)
  * `role`: Select the role to exempt
  * `action`: Choose "add" to exempt or "remove" to un-exempt
* `/listexemptroles`: List all roles that are currently exempt from moderation
* `/modstats`: View moderation statistics and violation history
  * `user`: Check a specific user's violations
  * `reset`: Reset a user's violation history

#### Natural Language Commands
* `.sol warn [user] for [reason]` - Warn a user about rule violations
* `.sol mute [user] for [time] because [reason]` - Temporarily mute/timeout a user
* `.sol say in #channel [message]` - Send a message to a specific channel
* `.sol search [query] and tell [user]` - Search for information online
* `.sol open this as an issue on github: [issue]` - Create a GitHub issue from message content
* `.sol create github issue in [org/repo]: [title]` - Create an issue in a specific repository

#### Management
* `/status`: View all current settings
* `/clear`: Clear conversation history
* `/reload`: Reload system prompt
* `/spark [channel] [topic]`: Make Sol start a conversation in a quiet channel
  - Intelligently analyzes recent channel conversations to identify engaging topics
  - Filters out commands and non-relevant messages for better context awareness
  - Can continue existing conversation threads or start new relevant discussions
  - Optional topic parameter allows directing the conversation to specific subjects

### Step 7: Invite Bot to Server

1. Go back to Discord Developer Portal
2. Go to OAuth2 -> URL Generator
3. Select scopes: "bot" AND "applications.commands"
4. Select permissions:
   - Read Messages/View Channels
   - Send Messages
   - Use Slash Commands
   - Read Message History
   - Moderate Members (for timeout functionality)
5. Copy the URL and open in browser
6. Select your server and authorize

### Step 8: Run the Bot

```bash
# Start screen session
screen -S sol

# Make sure venv is activated
source ~/sol/venv/bin/activate

# Run the bot
python ~/sol/bot.py

# Detach from screen with CTRL+A then D
```

## Troubleshooting Common Issues

### "pip: command not found"
Solution: Use `python3 -m pip` instead or install pip with `sudo apt install python3-pip`

### "externally-managed-environment" Error
Solution: Always use a virtual environment on Ubuntu. Make sure to activate it with `source venv/bin/activate`

### Slash commands not appearing
Solution: 
1. Make sure you invited the bot with BOTH "bot" and "applications.commands" scopes
2. Reinvite the bot if needed using the correct URL
3. Wait up to an hour for commands to sync

### Bot losing connection
Solution: Use `screen` or `systemd` to keep it running after SSH disconnects

## Admin Commands (Server Owner Only)

### Channel Control
- `/activate [channel]` - Turn Sol on in a specific channel
- `/deactivate [channel]` - Turn Sol off in a specific channel
- `/activateall` - Turn Sol on in all channels
- `/deactivateall` - Turn Sol off everywhere
- `/channels` - List channels where Sol is active
- `/spark [channel] [topic]` - Make Sol start a conversation in a quiet channel
  - Intelligently analyzes recent channel conversations to identify engaging topics
  - Filters out commands and non-relevant messages for better context awareness
  - Can continue existing conversation threads or start new relevant discussions
  - Optional topic parameter allows directing the conversation to specific subjects

### Settings
- `/setwindow [size]` - Set how many messages Sol remembers (5-50)
- `/setcasual [level]` - Set how casual Sol's replies are (1-10)
- `/timing [min] [max]` - Set typing delay in seconds

## Advanced Moderation Features

### Moderation Settings
- `/modconfig` - Configure core moderation settings
  - `enabled`: Turn moderation on/off
  - `auto_timeout`: Enable/disable automatic timeouts
  - `warning_threshold`: Set number of warnings before timeout (1-10)
  - `timeout_minutes`: Set timeout duration in minutes (1-60)
- `/setlogchannel`: Set up a logging channel and configure message deletion settings
  - `channel`: Channel where moderation logs will be sent
  - `delete_violations`: Whether to delete rule-violating messages
  - `warning_delete_seconds`: Time before warning messages auto-delete (0-300s)
- `/exemptrolefrommod`: Add or remove roles that are exempt from moderation
  - `role`: The role to exempt from moderation
  - `action`: "add" to exempt the role or "remove" to un-exempt
- `/listexemptroles`: List all roles that are currently exempt from moderation
- `/modstats`: View moderation statistics and violation history
  - `user`: Check a specific user's violations
  - `reset`: Reset a user's violation history

### Natural Language Moderation Commands
Use `.sol` prefix for natural language commands:
- `.sol warn [user] for [reason]` - Warn a user about rule violations
- `.sol mute [user] for [time] because [reason]` - Temporarily mute/timeout a user
- `.sol say in #channel [message]` - Send a message to a specific channel
- `.sol search [query] and tell [user]` - Search for information online
- `.sol open this as an issue on github: [issue]` - Create a GitHub issue from message content
- `.sol create github issue in [org/repo]: [title]` - Create an issue in a specific repository

To use GitHub integration:
1. Create a [GitHub personal access token](https://github.com/settings/tokens) with `repo` scope
2. Add it to your `.env` file as `GITHUB_TOKEN=your_token`
3. Optionally add a default repository as `GITHUB_REPO=username/repository`

### Community Rules & Moderation
Sol enforces these community rules by default:

1. Don't be hateful or harass others
2. Keep comparisons fair - no excessive trash-talking
3. Don't promote or provide instructions for jailbreaking, piracy or bypassing TOS
4. Discussing features or topics is fine, but don't encourage rule violations
5. Be generally cool to each other

The moderation system features:
- Informative warnings: Shows users their warning count (1/3, 2/3, 3/3) and what happens next
- Smart conversation memory: After warning a user, Sol avoids casual conversation with them for a period
- Context-aware moderation: Distinguishes between discussing topics vs. actively promoting rule violations
- Intent recognition: Focuses on the intent behind messages rather than just keywords
- Graduated warnings: First-time violators get gentle reminders, repeat offenders get stricter warnings
- Violation tracking: Keeps track of each user's rule violations with timestamps and severity
- Auto-timeout: Can automatically timeout users who repeatedly break rules (configurable)
- Timeout scaling: Timeout duration increases with more violations
- Admin controls: Admins can view violation history and reset user records
- Legal alternatives: Provides suggestions for legal alternatives when users ask about rule-violating topics
- Role exemptions: Administrators and specified roles can be exempted from moderation
